## 组件的属性和事件处理

![image-20240127125804189](img/image-20240127125804189.png)

对于组件的属性和事件处理，在Vue3中有一些变化和新特性。

1. 属性的处理：

   - 默认情况下，Vue3中的组件不再自动将未在props中声明的属性挂载到组件实例上。而是将这些未声明的属性直接传递给组件容器（即组件的根元素）。你可以通过`inheritAttrs`选项来控制该行为，默认值为`true`，如果设置为`false`，未声明的属性将不会被组件接收。
   - 如果你需要访问这些未声明的属性，你可以通过`$attrs`来获取它们。`$attrs`是一个包含了父组件传递给子组件的所有非props属性的对象。

2. 事件的处理：

   - 事件也可以通过`$attrs`传递给子组件。在父组件中使用`v-on`指令绑定的事件，可以直接通过`$attrs`传递给子组件，子组件可以使用`$emit`来触发这些事件。

   - 注意，使用`$emit`触发的事件只会向父组件派发，不会在组件内部冒泡。

   - 下面是一个简单的代码示例，演示了如何使用Vue3中的组件属性和事件处理：

     ```html
     <!-- ParentComponent.vue -->
     <template>
       <div>
         <h1>{{ title }}</h1>
         <ChildComponent :message="message" @custom-event="handleCustomEvent" />
       </div>
     </template>
     
     <script>
     import { ref } from 'vue';
     import ChildComponent from './ChildComponent.vue';
     
     export default {
       components: {
         ChildComponent
       },
       data() {
         return {
           title: 'Parent Component',
           message: 'Hello from Parent!'
         };
       },
       methods: {
         handleCustomEvent(payload) {
           console.log(payload);
           this.message = 'Custom event received: ' + payload;
         }
       }
     };
     </script>
     ```

     ```html
     <!-- ChildComponent.vue -->
     <template>
       <div>
         <p>{{ message }}</p>
         <button @click="emitCustomEvent">Click me!</button>
       </div>
     </template>
     
     <script>
     import { ref } from 'vue';
     
     export default {
       props: ['message'],
       methods: {
         emitCustomEvent() {
           this.$emit('custom-event', 'Custom event payload');
         }
       }
     };
     </script>
     ```

     在这个示例中，父组件`ParentComponent`通过props传递`message`属性给子组件`ChildComponent`，然后在子组件中，通过按钮点击事件，使用`$emit`方法触发了一个名为`custom-event`的自定义事件，并将一个自定义的payload作为参数传递给父组件。父组件通过在父组件模板中使用`v-on`指令来监听并处理这个自定义事件，在`handleCustomEvent`方法中，打印出payload信息，并将payload添加到`message`属性上进行更新，然后再次传递给子组件。

     当你运行这个示例时，父组件会显示一个标题和子组件的内容，子组件会显示父组件传递的`message`属性，并且点击按钮时，会触发自定义事件，并将payload值传递给父组件，父组件会打印payload值，并将其添加到`message`属性上进行更新，从而更新子组件的显示。

### $attrs

在你提供的代码中，你使用了Vue.js的`v-bind`指令来绑定`$attrs`对象到`<h2>`标签上。

`$attrs`是一个特殊变量，包含子组件接收到的所有未声明的属性。通过使用`v-bind`指令，你可以将`$attrs`中的属性传递给`<h2>`标签。

例如，假设父组件传递了以下属性给子组件：

```html
<template>
  <ChildComponent attr1="value1" attr2="value2" />
</template>
```

然后，在子组件中使用`v-bind`指令来绑定`$attrs`：

```html
<template>
  <h2 v-bind="$attrs">logo</h2>
</template>
```

在这种情况下，`$attrs`中的`attr1`和`attr2`属性会被传递给`<h2>`标签。这意味着生成的HTML代码将类似于：

```html
<h2 attr1="value1" attr2="value2">logo</h2>
```

这样，子组件中的`<h2>`标签会带有来自父组件的额外属性。

请注意，要使用`v-bind`指令绑定`$attrs`，你需要确保在子组件中的模板块内使用`v-bind`指令，并将其绑定到接收这些属性的标签上。

假设`$attrs`对象中包含了一个`title`属性，并且它的值是一个字符串。通过使用`v-bind`指令，你可以将`$attrs.title`的值绑定到`<h2>`标签的`title`属性上。

例如，如果父组件传递了以下属性给子组件：

```html
<template>
  <ChildComponent title="Website Logo" />
</template>
```

然后，在子组件中使用`v-bind`指令来绑定`$attrs.title`：

```html
<template>
  <h2 v-bind:title="$attrs.title">logo</h2>
</template>
```

在这种情况下，`$attrs.title`的值 "Website Logo" 会被传递给`<h2>`标签的`title`属性。生成的HTML代码将类似于：

```html
<h2 title="Website Logo">logo</h2>
```

这样，子组件中的`<h2>`标签会有一个标题为"Website Logo"的提示文本。

要注意的是，`v-bind`指令可以用于将动态数据绑定到元素的属性上。在这个例子中，我们使用`v-bind:title`来动态传递`$attrs.title`作为`<h2>`标签的标题。

。

## 组件的内容是如何组合与分发处理的

![image-20240127131728539](img/image-20240127131728539.png)

在Vue中，组件的内容组合和分发是通过使用`<slot>`元素来实现的。

`<slot>`元素可以在组件的模板中使用，作为组件的内容出口。它的作用是将父组件传递给子组件的内容插入到指定的位置。

具体而言，父组件可以在子组件中使用`<slot>`元素来定义一个插槽。插槽可以带有名称，以便父组件可以将具体的内容插入到特定的插槽中。

![image-20240127133105514](img/image-20240127133105514.png)

### 未命名插槽

例如，考虑以下的父组件和子组件：

```html
<!-- 父组件 -->
<template>
  <div>
    <h1>父组件</h1>
    <ChildComponent>
      <p>这是父组件插入的内容</p>
    </ChildComponent>
  </div>
</template>

<!-- 子组件 -->
<template>
  <div>
    <h2>子组件</h2>
    <slot></slot> <!-- 未命名的默认插槽 -->
  </div>
</template>
```

在这个例子中，父组件内插入了一个`<ChildComponent>`标签，其中包含一个`<p>`标签作为插入的内容。

子组件中有一个未命名的默认插槽`<slot></slot>`，它充当了子组件内容的出口。父组件插入的内容会被动态地渲染到子组件的插槽中。

当父组件和子组件进行组合时，最终生成的HTML代码类似于：

```html
<div>
  <h1>父组件</h1>
  <div>
    <h2>子组件</h2>
    <p>这是父组件插入的内容</p>
  </div>
</div>
```

在最终的渲染结果中，父组件插入的内容被正确地分发和组合到子组件的插槽中。

这种方式允许父组件向子组件传递动态的内容，并将其插入到子组件的指定位置。

除了默认的未命名插槽，Vue还支持具名插槽，使得父组件能够将内容插入到子组件中的特定命名插槽中。

### 具名插槽和作用域插槽

具名插槽（Named Slots）是Vue中的一种特性，它允许我们在组件中定义多个具名插槽，并在父组件中灵活地传递内容到这些插槽中。

具名插槽的使用方式与默认插槽类似，但是在模板中使用`<slot>`标签时，需要指定插槽的名称

作用域插槽（Scoped Slots）是Vue中的一个特性，它允许插槽可以访问子组件的数据。

通常情况下，插槽只能访问父组件的数据。但是在某些情况下，我们希望插槽能够访问子组件中的数据，这时就可以使用作用域插槽。

使用作用域插槽需要定义在子组件中的数据，并在父组件中通过插槽的语法接收并使用这些数据。

以下是一个示例代码，演示了作用域插槽的用法：

下面是对示例代码的注释：

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="../vue.global.js"></script>  <!-- 引入Vue库 -->
</head>
<body>
  <div id="app">
    <my-head>
      <!-- 具名插槽 #title 直接传递内容 -->
      <template #title>
        <p>logo, {{ message }}, {{ count }}</p>
      </template>
      <!-- 命名插槽 #list 传递内容，将子组件传递的list数据属性绑定上 -->
      <template #list="{ list }">
        <ul>
          <li v-for="item in list">{{ item }}</li>
        </ul>
      </template>
    </my-head>
  </div>
  <script>
    let app = Vue.createApp({
      data(){
        return {
          message: 'hello'
        }
      }
    })

    app.component('MyHead', {
      data(){
        return {
          count: 123,
          list: ['首页', '视频', '音乐']
        };
      },
      template: `
        <header>
          <slot name="title"></slot> <!-- 默认内容插槽 -->
          <hr>
          <slot name="list" :list="list"></slot> <!-- 命名插槽，并传递属性list -->
        </header>
      `,
    });
    
    let vm = app.mount('#app');  <!-- 将Vue实例挂载到#app节点上 -->
  </script>
</body>
</html>
```

## 仿Element Plus框架的el-button按钮组件实现

![image-20240127134648366](img/image-20240127134648366.png)

在Vue中，`data`用于定义组件中的数据。它是一个函数或对象，用于存储组件的状态和属性。当数据发生变化时，Vue会根据`data`的定义来更新视图，确保视图与数据保持同步。

```vue
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .el-button{
      display: inline-flex;
      justify-content: center;
      align-items: center;
      line-height: 1;
      height: 32px;
      white-space: nowrap;
      cursor: pointer;
      background-color: #ffffff;
      border: 1px solid #dcdfe6;
      border-color: #dcdfe6;;
      color: #606266;
      -webkit-appearance: none;
      text-align: center;
      box-sizing: border-box;
      outline: none;
      transition: .1s;
      font-weight: 500;
      user-select: none;
      vertical-align: middle;
      padding: 8px 15px;
      font-size: 14px;
      border-radius: 4px;
    }
    .el-button--primary{
      color: white;
      background-color: #409eff; 
    }
    .el-button--success{
      color: white;
      background-color: #67c23a; 
    }
    .el-button--large{
      height: 40px;
      padding: 12px 19px;
      font-size: 14px;
    }
    .el-button--small{
      height: 24px;
      padding: 5px 11px;
      font-size: 12px;
      border-radius: 3px;
    }
  </style>
  <link rel="stylesheet" href="./iconfont/iconfont.css">
  <script src="../vue.global.js"></script>
</head>
<body>
  <div id="app">
    <el-button>default</el-button>
    <el-button type="primary" size="small">Primary</el-button>
    <el-button type="success" size="large">Success</el-button>
    <el-button type="success" size="large">
      <template #icon>
        <i class="iconfont iconfangdajing"></i>
      </template>
      Success
    </el-button>
  </div>
  <script>

    let ElButton = { //定义组件
      data(){
        return {
          buttonClass: {//样式
            'el-button': true,
            [`el-button--${this.type}`]: this.type !== '',  //动态样式
            [`el-button--${this.size}`]: this.size !== '' 
          }
        }
      },
      props: { //传递的参数集合
        type: {
          type: String,
          default: ''
        },
        size: { 
          type: String,
          default: ''
        }
      },
      //整个组件的内容模板
      template: ` 
        <button :class="buttonClass">
          <slot name="icon"></slot>
          <slot></slot>
        </button>
      ` 
    };

    let vm = Vue.createApp({
      data(){
        return {
        }
      },
      components: {
        ElButton //传递组件
      }
    }).mount('#app');
  </script>
</body>
</html>
```

